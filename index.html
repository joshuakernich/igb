<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>IGB Porotypes</title>
	<script type="text/javascript" src="./shared/jq.js"></script>
	<script type="text/javascript">
		$(function () {
			const proto = {
				
				'FIL JUMP':'fil/jump.html',
				'LOS MAZE':'los/maze-nav.html',

			}

			for(var p in proto){
				$('<li>').appendTo('ul').text(p).attr('url',proto[p]).click(launchProto);
			}

			function launchProto() {
				let url = $(this).attr('url');
				$('iframe').attr('src',url).addClass('active');
			}

			$('button').click(function() {
				$('iframe').removeClass('active').attr('src','');
			})

			let log = [];

			/*window.vuplex.addEventListener(
			  "message",
			  (event) => {
			  	log.unshift( event.data.toString());
			  	if(log.length>10) log.length = 10;
			    $('textarea').html(log.join('<br>'));
			  },
			  false,
			);*/


			doLog('Vuplex is '+window.vuplex);
			// The window.vuplex object gets created when the page starts loading,
			// so we double-check that it exists before using it here.
			// You can skip this step if you're sending a message after the page has loaded.
			if (window.vuplex) {
			    // The window.vuplex object already exists, so go ahead and send the message.
			    sendMessageToCSharp();
			} else {
			    // The window.vuplex object hasn't been initialized yet because the page is still
			    // loading, so add an event listener to send the message once it's initialized.
			    window.addEventListener('vuplexready', sendMessageToCSharp);
			}

			function sendMessageToCSharp() {
				doLog('Vuplex is '+window.vuplex);
			    // This object passed to postMessage() automatically gets serialized as JSON
			    // and is emitted via the C# MessageEmitted event. This API mimics the window.postMessage API.
			    window.vuplex.postMessage({ type: 'greeting', message: 'Hello from JavaScript!' });
			}

			doLog('Vuplex is '+window.vuplex);

			if (window.vuplex) {
			    addMessageListener();
			} else {
			    window.addEventListener('vuplexready', addMessageListener);
			}

			function addMessageListener() {
				doLog('Vuplex is '+window.vuplex);
			    window.vuplex.addEventListener('message', function(event) {
			        let json = event.data;
			        // > JSON received: { "type": "greeting", "message": "Hello from C#!" }
			        console.log('JSON received: ' + json);

			        doLog(json);

			    });
			}

			function doLog(str){
				log.unshift( str );
			  	if(log.length>10) log.length = 10;
			    $('logger').html(log.join('<br>'));
			}

			

			$(document).click(function(e){
				$('<dot type=red>').appendTo('body').css({left:e.pageX,top:e.pageY}).animate({width:150,height:150,opacity:0},500,function(){
					$(this).remove();
				});
			})

		})
	</script>
	<style type="text/css">
		body{
			background: #333;
		}

		dot{
			position: fixed;
			width: 20px;
			height: 20px;
			
			transform: translate(-50%,-50%);
			background: radial-gradient(transparent, transparent, white, transparent, transparent);
			border-radius: 100px;
		}

		dot[type="blue"]{
			background: blue;
		}

		
		logger{
			position: fixed;
			height: 50vh;
			width: 500px;
			bottom: 0px;
			left: 50px;
			background: white;
			font-family: sans-serif;
		}
		.active{
			position: fixed;
			top: 0px;
			left: 0px;
			right: 0px;
			bottom: 0px;
			width: 100vw;
			height: 100vh;
			border: none;
			display: block;
		}

		iframe{
			display: none;
		}

		button{
			position: fixed;
			top: 0px;
			left: 0px;
			margin: 50px;
			width: 100px;
			height: 100px;
			background: white;
			box-sizing: border-box;
		}

		ul{
			width: 800px;
			height: 400px;
			position: fixed;
			top: 0px;
			left: 0px;
			right: 0px;
			bottom: 0px;
			margin: auto;
			list-style-type: none;
			margin: auto;
			padding: 0px;
		}

		li{
			list-style-type: none;
			margin: 0px;
			padding: 0px;
			width: 100px;
			height: 100px;
			line-height: 100px;
			box-sizing: border-box;
			background: white;
			text-align: center;
			display: inline-block;
			margin: 5px;
		}
	</style>
</head>
<body>
	<ul></ul>
	<logger>LOADING...</logger>
	<iframe src=""></iframe>
	<button>MENU</button>
</body>
</html>