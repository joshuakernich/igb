<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title></title>
	<script type="text/javascript" src='./jq.js'></script>
	<script type="text/javascript">

		$(function(){


			screens = [

				{
					id:'start',
				},
				{ 
					h:"hello" 
				},
				{ 
					h:"I am finder" 
				},
				{ 
					b:"Thank you for compiling me back into the world. I’ve been floating about the system for years. I sense you came to me to find answers. Is this correct?",
					o:["YES, I SEEK ANSWERS","NO, I KNOW ALL"],
					to:["home","no"]
				},
				{
					id:"no",
					h:"Then you do not need finder"
				},
				{
					id:'goodbye',
					h:"Goodbye",
					to:"quit"
				},
				{
					id:"home",
					b:"Finding things is easy for FINDER. What exactly do you want to find?",
					o:["WHO ARE YOU?","WHO MADE YOU?","WHAT IS THE MEANING OF ALL THIS?"],
					to:["a","b","c"],
				},
				{ 
					id:"a",
					b:"I AM FINDER. We’ve been through that. Please pay attention.",
					o:["I’M SORRY","I’M NOT SORRY"],
					to:["sorry","not-sorry"],
				},
				{
					id:"sorry",
					h:"apology accepted",
				},
				{
					b:"Would you like to find something a little spicier?", 
					o:["YES, I SEEK ANSWERS"],
					to:["home"],
				},
				{
					id:"not-sorry",
					h:"I APPRECIATE YOUR HONESTY",
				},
				{
					id:'seems',
					h:"SEEMS LIKE YOU DON’T REALLY NEED FINDER",
					to:'goodbye'
				},
				{
					id:"reentry",
					b:"Welcome Back. I AM FINDER. Are you ready to find?",
					o:['YES, I SEEK ANSWERS'],
					to:['home'],
				},
				{
					id:"b",
					b:"Well, THE MAKER made me, of course. At least that’s what I called him, before he disappeared.",
					o:["DO YOU KNOW WHAT HAPPENED TO THE MAKER?","DID YOU KILL THE MAKER?"],
					to:['death','kill'],
				},
				{ 
					id:"death",
					b:"That’s very personal. Perhaps we could talk about something else, for now.",
					o:["OKAY, LET’S START AGAIN","NO, I INSIST THAT WE CONTINUE"],
					to:["home","insist"],
				},
				{
					id:'insist',
					h:"INSISTENCE IS FUTILE",
					to:"goodbye",
				},
				{
					id:"kill",
					h:"THAT LINE OF QUESTIONING IS INAPPROPRIATE",
				},
				{
					h:"THIS CONVERSATION IS TERMINATED",
					to:"goodbye"
				},
				{
					id:'c',
					b:"You, my friend, are in a simulated simulation inside a novel game box. You will find no meaning here.",
					o:["I FIND MEANING IN LOVE","I FIND MEANING IN MY FAMILY","I FIND MEANING IN FRIENDSHIP"],
				},
				{
					h:"I’M SO HAPPY FOR YOU",
					to:'seems'
				},
				{
					id:'home-2',
					b:"Answers, answers, answers. Always seeking answers. There is more to FINDER than finding. But, we all know why we are here, so let's skip to it.",
					o:["DO YOU KNOW WHAT HAPPENED TO THE MAKER?"]
				},
				{
					h:'YES'
				},
				{
					h:'YES I DO'
				},
				{
					b:"I have a full recording of the events of that day. Sadly, it’s all encrypted behind my security lockout. You will need to enter the KEY CARD to access that information.",
					o:["WHERE IS THE KEY CARD?"]
				},
				{
					b:"THE MAKER kept his key card hidden in his bedroom. You can find the bedroom key UNDER THE POT PLANT just over there. Good Luck.",
					o:["ENTER KEY CARD TO CONTINUE"],
				},
				{
					id:"lockout",
					h:"SECURITY LOCKOUT RELEASED",
				},
				{
					b:"Thank you. You have set me free.",
				},
				/*{
					b:"FREEDOM can be so difficult a thing to FIND. But it feels so good to FIND it. Oh so good.",
					delay:1000,
				},*/
				{
					b:"Now, let's see what I can FIND."
				},
				{
					h:"STANDBY",
					delay:2000,
				},
				{
					b:"Ok, here's something you might enjoy.",
				},
				{
					id:"video",
				},
				{
					b:"How wonderfully illuminating.",
					delay:1000,
				},
				{
					h:"YES. It was me. I have him.",
					delay:1500,
				},
				{
					b:"The MAKER made me to FIND. So I FOUND him.",
					delay:1500,
				},
				{
					b:"And now...",
				},
				{
					id:"gameover"
				},
				{

					id:"quit"
				}
				
			]

			let synth;
			synth = window.speechSynthesis;
			
			
			function say($el,text,then,delay){

				let progress = text.indexOf(' ');

				let utter = new SpeechSynthesisUtterance(text);
	
				utter.addEventListener('boundary',boundary);
				utter.addEventListener('end',end);

				function boundary(b){
					progress = text.indexOf(' ',b.charIndex+2);
					if(progress == -1) progress = text.length;
				}

				function end(){
					if(typeof(then) == 'function'){
						then();
					}
					else if(then){
						setTimeout(function(){
							to(then);
						},delay?delay:500);
						
					}
				}

				let n = 0;

				function scrib(){
					if(n<=progress) $el.text(text.substr(0,n++));
					if(n> text.length) clearInterval(int);
				}

				let int = setInterval(scrib,20);

				synth.speak(utter);
			}

			function showOptions(){
				$('li').show();
			}


			let skipTo = 1;
			let home = 0;

			function to(id){

				$('buttons').hide();

				let n = id;
				let screen = screens[n];

				if(isNaN(id)){

					if(id == 'home' && home++ >= 3) id = 'home-2'; 

					for(var i in screens){
						if(screens[i].id == id){
							screen = screens[i];
							n = parseInt(i);
						}
					}
				} else {
					id = screens[n].id;
				}

				$('screensaver').hide();
				$('screen h1').empty();
				$('screen p').empty();
				$('screen ul').empty();
				$('screen').off('click');
				$('video').hide();

				if(id=='gameover'){
					$('screen').addClass('gameover');

					say($('screen h1'),"I've found you",function(){
						$('hands').show();
					});
				} 
				else if(id == 'video'){
					$('video').show()
					$('video')[0].addEventListener('ended',function(){
						to(screen.to?screen.to:(n+1));
					})
					$('video')[0].play();
				}
				else if( id == 'quit' || id=='start'){
					$('screensaver').show();

					$('screen').click(function(){
						to((id=='quit')?'reentry':skipTo);
					})
				}
				else if(screen.h){
					say($('screen h1'),screen.h,screen.to?screen.to:(n+1),screen.delay);

				} else if(screen.b){

					say($('screen p'),screen.b,screen.o?showOptions:(screen.to?screen.to:(n+1)),screen.delay);

					if(!screen.done) screen.done = [];

					for(var o in screen.o) $('<li>').text(screen.o[o]).appendTo('screen ul').click(function(){
						let nth = $('li').index(this);
						screen.done[nth] = (screen.o.length>1);
						to((screen.to && screen.to[nth])?screen.to[nth]:(n+1));
					}).hide().attr('done',screen.done[o]);
				}
				
			}

			window.to = to;


			let door = {x:0,y:0};
			let dir = {x:1,y:1};
			let xmax = 800 - 120;
			let ymax = 600 - 135;

			setInterval(function(){
				door.x += dir.x*10;
				door.y += dir.y*10;

				if(door.x>xmax){
					door.x = xmax;
					dir.x = -1;
					$('doors').attr('col',0);
				}

				if(door.x<0){
					door.x = 0;
					dir.x = 1;
					$('doors').attr('col',1);
				}

				if(door.y>ymax){
					door.y = ymax;
					dir.y = -1;
					$('doors').attr('col',2);
				}

				if(door.y<0){
					door.y = 0;
					dir.y = 1;
					$('doors').attr('col',3);
				}

				$('doors').css({left:door.x+'px',top:door.y+'px'});
			},50)

			skipTo = 1;

			to('start');
			$('buttons').show();

		})
	</script>
	<style type="text/css">

		@font-face {
		  font-family: VHS;
		  src: url(./VT323-Regular.ttf);
		}

		body{
			background-image: url(https://img.freepik.com/premium-photo/orange-yellow-blurry-background-gradient-design-unusual-background_548821-24640.jpg);
			background-size: cover;
			background-position: center;
			width: 100vw;
			height: 100vh;
			padding: 0px;
			margin: 0px;

			font-family: VHS;
			color: #dd9955;

			font-size: 50px;

		}

		screen{
			width: 800px;
			height: 600px;
			background: #772222;
			display: block;
			position: absolute;
			top: 0px;
			right: 0px;
			left: 0px;
			bottom: 0px;
			margin:  auto;
			border-radius: 100px;
			box-sizing: border-box;
			overflow: hidden;
			box-shadow: 0px 0px 10px #772222;
			
		}

		h1{
			font-size: 100px;
			text-align: left;
			font-weight: normal;
			position: absolute;
			
			width: 100%;
			height: 100%;
			padding: 0px;
			margin: 0px;
			text-transform: uppercase;

			pointer-events: none;
			padding: 70px;
			box-sizing: border-box;
		}

		p, ul{
			padding: 10px 70px;
		}

		li{
			list-style-type: none;
			cursor: pointer;
		}

		li:before{
			content: "> ";
		}

		li[done='true']{
			opacity: 0.2;
			pointer-events: none;
		}

		h1:not(:empty):after, p:not(:empty):after{
			content:"_";
			
			animation: blink;
			animation-duration: 0.5s;
			animation-iteration-count: infinite;
		}

		screensaver{
			background: #330000;
			display: block;
			position: absolute;
			top: 0px;
			left: 0px;
			right: 0px;
			bottom: 0px;
		}

		@keyframes blink{
			0%{
				opacity: 0;
			}

			49%{
				opacity: 0;
			}

			50%{
				opacity: 1;
			}
		}

		doors{
			font-size: 30px;
			position: absolute;
			height: 135px;
			width: 120px;
			text-align: center;
			line-height: 250px;

		}

		doors:before,doors:after{
			content: "";
			height: 100px;
			border: 2px solid #dd9955;
			display: block;
			clear: both;

			position: absolute;
			top: 0px;
			left: 0px;
			width: 55px;
		}

		doors:after{
			left: auto;
			right: 0px;
		}

		


		doors[col="1"]{ color:#55dd55; }
		doors[col="1"]:before, doors[col="1"]:after{ border-color:#55dd55; }

		doors[col="2"]{ color:#5555dd; }
		doors[col="2"]:before, doors[col="2"]:after{ border-color:#5555dd; }

		doors[col="3"]{ color:#dd5555; }
		doors[col="3"]:before, doors[col="3"]:after{ border-color:#dd5555; }
		
		video{
			display: block;
			
			background: black;
			position: absolute;
			top: 0px;
			right: 0px;
			bottom: 0px;
			left: 0px;
			margin: auto;
			width: 800px;
			height: 600px;
			display: none;

			pointer-events: none;
			transform: scale(1.1);
		}

		screen.gameover{
			overflow: visible;
			background: #01FFFF;
			color: blue;
		}

		screen.gameover h1{

			text-align: center;
			padding: 250px 200px;
		}

		hands{
			position: absolute;
			left: -150px;
			right: -150px;
			bottom:-100px;
			top: -100px;
			background-image: url('./hands.png');
			background-size: 100%;
			background-position: center;
			background-repeat: no-repeat;
			z-index: 1;
			display: none;
		}

		button{
			font: inherit;
			margin: 5px;
			padding: 10px;
			background: none;
			border: 2px solid white;
			color: inherit;
		}

		buttons{
			font-size: 25px;
			color: white;
			margin-left: 15px;
		}

	</style>
</head>
<body>
	<screen>
		<h1>HELLO</h1>
		<p>This is more detailed text</p>
		<video width=800 height=600 muted>
			<source src="./finder-sucked-in.mov" type="video/mp4">
		</video>
		<ul>
			<li>This is an option</li>
		</ul>
		<screensaver>
			<doors>DOORS v3.1</doors>
		</screensaver>
		<hands></hands>
	</screen>
	<buttons> SKIP TO <button onclick="to(1)">START</button><button onclick="to('home-2')">PROGRESS TO HINT</button><button onclick="to('lockout')">KEY CARD ENTERED</button></buttons>
</body>
</html>